# 蓮城院公式サイト 設計書【MVP版】

## 1. システムアーキテクチャ

### 1.1 全体構成（MVP）
```
┌─────────────────────────────────────────────────┐
│                   フロントエンド                    │
│              Next.js (App Router)                 │
│                 TypeScript                        │
│                 Tailwind CSS                      │
└─────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────┐
│                 CMS & API層                       │
│               Sanity CMS                          │
│           (コンテンツ管理・配信)                   │
└─────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────┐
│                 インフラ・分析                      │
│              Vercel (ホスティング)                 │
│            Google Analytics 4                     │
└─────────────────────────────────────────────────┘
```

### 1.2 ディレクトリ構造（MVP）
```
renjoin-temple/
├── app/                      # Next.js App Router
│   ├── layout.tsx           # ルートレイアウト
│   ├── page.tsx             # トップページ
│   ├── about/               # 由緒・歴史
│   │   └── page.tsx
│   ├── events/              # 年間行事
│   │   └── page.tsx
│   ├── news/                # お知らせ
│   │   ├── page.tsx         # 一覧ページ
│   │   └── [slug]/
│   │       └── page.tsx     # 詳細ページ
│   ├── blog/                # 副住職ブログ
│   │   ├── page.tsx         # 一覧ページ
│   │   └── [slug]/
│   │       └── page.tsx     # 記事詳細
│   ├── contact/             # お問い合わせ
│   │   └── page.tsx
│   ├── terms/               # 利用規約
│   │   └── page.tsx
│   ├── privacy/             # プライバシーポリシー
│   │   └── page.tsx
│   └── globals.css
├── components/              # 共通コンポーネント
│   ├── common/             # 基本コンポーネント
│   │   ├── Header.tsx
│   │   ├── Footer.tsx
│   │   └── SEO.tsx
│   └── ui/                 # UIコンポーネント
│       ├── Card.tsx
│       └── Button.tsx
├── lib/                    # ユーティリティ
│   ├── sanity.ts          # Sanity設定
│   └── utils.ts           # 汎用関数
├── types/                  # 型定義
│   └── sanity.ts
├── sanity/                 # Sanity設定
│   ├── schemas/           # データスキーマ
│   │   ├── blog.ts
│   │   ├── news.ts
│   │   └── page.ts
│   └── sanity.config.ts
├── public/                 # 静的ファイル
│   ├── images/
│   └── icons/
├── .env.local             # 環境変数（Gitから除外）
└── .gitignore             # Git除外設定
```

## 2. Sanity CMS スキーマ設計

### 2.1 スキーマ構造（MVP）

#### ブログ記事 (blog)
```typescript
{
  name: 'blog',
  title: 'ブログ記事',
  type: 'document',
  fields: [
    {
      name: 'title',
      title: 'タイトル',
      type: 'string',
      validation: Rule => Rule.required()
    },
    {
      name: 'slug',
      title: 'URL スラッグ',
      type: 'slug',
      options: { source: 'title' },
      validation: Rule => Rule.required()
    },
    {
      name: 'publishedAt',
      title: '公開日',
      type: 'datetime',
      validation: Rule => Rule.required()
    },
    {
      name: 'excerpt',
      title: '概要',
      type: 'text',
      rows: 3
    },
    {
      name: 'body',
      title: '本文',
      type: 'array',
      of: [
        { type: 'block' },
        { type: 'image' }
      ]
    },
    {
      name: 'mainImage',
      title: 'メイン画像',
      type: 'image',
      options: { hotspot: true }
    }
  ]
}
```

#### お知らせ (news)
```typescript
{
  name: 'news',
  title: 'お知らせ',
  type: 'document',
  fields: [
    {
      name: 'title',
      title: 'タイトル',
      type: 'string',
      validation: Rule => Rule.required()
    },
    {
      name: 'slug',
      title: 'URL スラッグ',
      type: 'slug',
      options: { source: 'title' },
      validation: Rule => Rule.required()
    },
    {
      name: 'publishedAt',
      title: '公開日',
      type: 'datetime',
      validation: Rule => Rule.required()
    },
    {
      name: 'category',
      title: 'カテゴリー',
      type: 'string',
      options: {
        list: [
          { title: '行事案内', value: 'event' },
          { title: 'お知らせ', value: 'notice' },
          { title: '法要', value: 'service' }
        ]
      }
    },
    {
      name: 'content',
      title: '内容',
      type: 'array',
      of: [{ type: 'block' }]
    }
  ]
}
```

#### 固定ページ (page)
```typescript
{
  name: 'page',
  title: '固定ページ',
  type: 'document',
  fields: [
    {
      name: 'title',
      title: 'ページタイトル',
      type: 'string',
      validation: Rule => Rule.required()
    },
    {
      name: 'slug',
      title: 'URL スラッグ',
      type: 'slug',
      options: { source: 'title' },
      validation: Rule => Rule.required()
    },
    {
      name: 'body',
      title: '本文',
      type: 'array',
      of: [
        { type: 'block' },
        { type: 'image' }
      ]
    },
    {
      name: 'metaDescription',
      title: 'メタディスクリプション',
      type: 'text',
      rows: 2
    }
  ]
}
```

### 2.2 セキュリティ設定

#### 環境変数管理
```
NEXT_PUBLIC_SANITY_PROJECT_ID=your_project_id
NEXT_PUBLIC_SANITY_DATASET=production
SANITY_API_TOKEN=your_api_token  # 読み取り専用
NEXT_PUBLIC_GA_ID=your_ga_id
```

#### Sanity権限設定
- 公開データ：読み取り専用アクセス
- 管理権限：Sanity Studio経由のみ
- APIトークン：最小権限の原則

## 3. ページ設計（MVP）

### 3.1 トップページ構成
```
┌─────────────────────────────────────┐
│          ヘッダー                     │
├─────────────────────────────────────┤
│      ヒーローセクション                │
│  （境内写真背景 + 縦書きキャッチ）      │
├─────────────────────────────────────┤
│      お知らせセクション（3件）          │
├─────────────────────────────────────┤
│        蓮城院由緒セクション            │
├─────────────────────────────────────┤
│    副住職ブログセクション（3件）        │
├─────────────────────────────────────┤
│      アクセス情報セクション            │
├─────────────────────────────────────┤
│          フッター                     │
└─────────────────────────────────────┘
```

### 3.2 レスポンシブブレークポイント
- Mobile: 0-640px
- Tablet: 640px-1024px
- Desktop: 1024px以上

## 4. コンポーネント設計（MVP）

### 4.1 基本コンポーネント

#### Header
```typescript
interface HeaderProps {
  currentPath?: string;
}

// 機能：
// - ナビゲーションメニュー
// - レスポンシブデザイン
// - シンプルな構成
```

#### Hero
```typescript
interface HeroProps {
  title: string;
  subtitle?: string;
  backgroundImage: string;
  isVertical?: boolean; // 縦書き対応
}

// 機能：
// - 背景画像表示
// - 縦書きテキスト対応
// - レスポンシブ対応
```

#### Card
```typescript
interface CardProps {
  title: string;
  excerpt?: string;
  date: string;
  href: string;
  category?: string;
}

// 機能：
// - ブログ記事・お知らせ表示用
// - ホバーエフェクト
// - リンク機能
```

#### SEO
```typescript
interface SEOProps {
  title: string;
  description: string;
  ogImage?: string;
}

// 機能：
// - メタタグ設定
// - OGP対応
// - Twitter Card対応
```

## 5. データ取得設計（Sanity）

### 5.1 Sanityクエリ

#### ブログ記事関連
```typescript
// 記事一覧
const blogListQuery = `
  *[_type == "blog"] | order(publishedAt desc) {
    _id,
    title,
    slug,
    publishedAt,
    excerpt,
    mainImage
  }
`;

// 記事詳細
const blogDetailQuery = `
  *[_type == "blog" && slug.current == $slug][0] {
    title,
    slug,
    publishedAt,
    body,
    mainImage
  }
`;
```

#### お知らせ関連
```typescript
// お知らせ一覧
const newsListQuery = `
  *[_type == "news"] | order(publishedAt desc) {
    _id,
    title,
    slug,
    publishedAt,
    category
  }
`;
```

#### 固定ページ
```typescript
// 固定ページ取得
const pageQuery = `
  *[_type == "page" && slug.current == $slug][0] {
    title,
    body,
    metaDescription
  }
`;
```

## 6. デザインシステム（MVP）

### 6.1 カラーパレット（Tailwind CSS）
```css
/* Zenテーマ参考の和モダンカラー */
:root {
  --color-primary: #2D3748;      /* 墨色 */
  --color-secondary: #B8860B;    /* 金茶色 */
  --color-accent: #C53030;       /* 朱色 */
  --color-neutral: #F7FAFC;      /* 白系 */
  --color-text: #1A202C;         /* テキスト */
  --color-bg: #FFFFFF;           /* 背景 */
}
```

### 6.2 タイポグラフィ（Tailwind CSS）
```css
/* 日本語フォント */
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;500;600;700&display=swap');

.font-serif { font-family: 'Noto Serif JP', serif; }
.font-sans { font-family: 'Noto Sans JP', sans-serif; }

/* 縦書き対応 */
.vertical-text {
  writing-mode: vertical-rl;
  text-orientation: upright;
}
```

### 6.3 レスポンシブ設計
- モバイルファースト
- 大きな余白を効果的に活用
- 静かで荘厳な雰囲気を重視

## 7. セキュリティ実装（最優先）

### 7.1 XSS対策実装
```typescript
// DOMPurifyによるサニタイズ
import DOMPurify from 'dompurify';

const sanitizeHtml = (html: string) => {
  return {
    __html: DOMPurify.sanitize(html)
  };
};

// ブログ本文表示時
<div 
  dangerouslySetInnerHTML={sanitizeHtml(content)} 
/>
```

### 7.2 環境変数管理
```bash
# .env.local
NEXT_PUBLIC_SANITY_PROJECT_ID=your_project_id
NEXT_PUBLIC_SANITY_DATASET=production
SANITY_API_TOKEN=your_read_only_token
NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX
```

### 7.3 Git設定
```bash
# .gitignore
.env.local
.env.*.local
```

## 8. パフォーマンス最適化（MVP）

### 8.1 静的サイト生成（SSG）
```typescript
// ブログ記事のSSG
export async function generateStaticParams() {
  const posts = await client.fetch(
    `*[_type == "blog"]{slug}`
  );
  return posts.map((post) => ({
    slug: post.slug.current,
  }));
}
```

### 8.2 画像最適化
- Next.js Image Componentの使用
- Sanityの画像最適化機能を活用
- WebP形式自動対応

### 8.3 キャッシュ戦略
- 静的ページのSSG
- ブログ記事のISR（必要に応じて）

## 9. SEO対策（MVP）

### 9.1 メタデータ（基本設定）
```typescript
// app/layout.tsx
export const metadata = {
  title: {
    default: '蓮城院 | 曹洞宗の寺院',
    template: '%s | 蓮城院'
  },
  description: '蓮城院の公式サイト。副住職・荒木弘文のブログも掲載。',
  openGraph: {
    title: '蓮城院',
    description: '曹洞宗の寺院。正式サイト。',
    type: 'website',
    locale: 'ja_JP'
  }
};
```

### 9.2 サイトマップ自動生成
- Next.jsのApp Router機能を活用
- 静的ページと動的ページの両方に対応

## 10. 開発フロー（MVP）

### 10.1 開発環境
```bash
# ローカル開発
npm run dev

# Sanity Studio
npm run sanity:dev

# ビルド確認
npm run build
```

### 10.2 デプロイフロー
1. GitHubにプッシュ
2. Vercelで自動デプロイ
3. 環境変数のVercel設定

### 10.3 モニタリング
- Vercel Analytics
- Google Analytics 4
- Google Search Console