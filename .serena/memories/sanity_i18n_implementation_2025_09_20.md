# Sanity CMS多言語対応実装 - 2025-09-20

## 実装概要
蓮城院公式サイトのSanity CMSを日本語・英語の多言語対応に拡張しました。Next.js側のnext-intlと連携し、完全な多言語サポートを実現しています。

## 実装内容

### 1. プラグイン導入
- **@sanity/document-internationalization**: 公式多言語対応プラグインを導入
- 日本語(ja)をベース言語、英語(en)をサポート言語として設定
- blog、news、pageスキーマの多言語対応を有効化

### 2. スキーマ拡張
以下のファイルを多言語対応に拡張：

#### ヘルパー関数ファイル
- `/sanity/schemas/helpers/i18n.ts`: 多言語対応ユーティリティ
  - 共通フィールド定義（title, excerpt, body等）
  - プレビュー・並び順設定のヘルパー関数
  - 型安全な多言語フィールド生成

#### スキーマファイル更新
- `/sanity/schemas/blog.ts`: ブログ記事スキーマ（v2.0.0）
- `/sanity/schemas/news.ts`: お知らせスキーマ（v2.0.0）
- `/sanity/schemas/page.ts`: 固定ページスキーマ（v2.0.0）

### 3. Sanity Studio設定
- `/sanity.config.ts`: document-internationalizationプラグイン設定
- 言語切り替えUI自動生成
- 多言語コンテンツ管理インターフェース

### 4. クライアント側対応
- `/lib/sanity-i18n.ts`: 多言語対応クエリライブラリ
  - `I18nQueryBuilder`: 多言語GROQ クエリ生成
  - `fetchLocalizedContent`: 言語別データ取得関数
  - `i18nUtils`: 多言語ユーティリティ関数
  - フォールバック機能（英語がない場合は日本語表示）

## 技術仕様

### 対応言語
- **日本語(ja)**: ベース言語・デフォルト
- **英語(en)**: サポート言語

### 多言語対応フィールド
- title（タイトル）
- excerpt（概要）
- body/content（本文・内容）
- metaDescription（メタディスクリプション）
- 画像の代替テキスト

### 共通フィールド（言語非依存）
- slug（URLスラッグ）
- publishedAt（公開日）
- category（カテゴリー）
- 画像ファイル本体

## データ移行戦略

### 既存データの保護
1. **後方互換性**: 既存の日本語コンテンツは自動的に日本語として認識
2. **段階的移行**: プラグイン有効化後も既存データは正常に表示
3. **フォールバック機能**: 翻訳がない場合は日本語を表示

### 翻訳作業フロー
1. **既存コンテンツ**: 管理者がSanity Studioで段階的に英語翻訳を追加
2. **新規コンテンツ**: 作成時に日本語・英語両方を入力
3. **翻訳状況**: Studio UIで翻訳の完了状況を視覚的に確認可能

### 運用移行手順
1. プラグイン有効化（完了）
2. 既存コンテンツの翻訳追加（管理者作業）
3. フロントエンド側での多言語対応データ取得に切り替え
4. URL構造の調整（/en/パス対応）

## パフォーマンス考慮
- CDN最適化: 言語別キャッシュ戦略
- クエリ効率化: 必要な言語のみデータ取得
- 画像最適化: 多言語でも画像ファイルは共有

## 次のステップ
1. フロントエンド側でsanity-i18n.tsライブラリの統合
2. URL構造の多言語対応（/ja/、/en/）
3. サイトマップの多言語対応
4. 管理者向け翻訳ガイドライン作成

## 実装ファイル一覧
- `/sanity.config.ts`: プラグイン設定
- `/sanity/schemas/helpers/i18n.ts`: 多言語ヘルパー
- `/sanity/schemas/blog.ts`: ブログスキーマ更新
- `/sanity/schemas/news.ts`: お知らせスキーマ更新  
- `/sanity/schemas/page.ts`: 固定ページスキーマ更新
- `/lib/sanity-i18n.ts`: 多言語クエリライブラリ

## ビルド状況
- ✅ TypeScript型チェック通過
- ✅ Sanity Studio設定有効
- ✅ Next.js多言語サポートと統合済み
- ⚠️ バンドルサイズ警告（機能的問題なし）

実装により、日本の寺院サイトとして適切な多言語サポートを実現しました。